{
  "$id": "https://flows.pipecat.ai/schema/flow.json",
  "meta": { "name": "Food Ordering", "version": "0.1.0", "description": "Initial -> Pizza/Sushi Branch -> Confirm -> End" },
  "nodes": [
    {
      "id": "initial",
      "type": "initial",
      "position": { "x": 100, "y": 100 },
      "data": {
        "label": "Initial",
        "role_messages": [
          { "role": "system", "content": "You are a helpful food ordering assistant. You must ALWAYS use the available functions to progress the conversation." }
        ],
        "task_messages": [
          { "role": "system", "content": "Welcome! Greet the user warmly and ask if they would like to order pizza or sushi today." }
        ],
        "functions": [
          { "name": "choose_pizza", "description": "User wants to order pizza", "next_node_id": "pizza_task" },
          { "name": "choose_sushi", "description": "User wants to order sushi", "next_node_id": "sushi_task" }
        ]
      }
    },
    {
      "id": "pizza_task",
      "type": "llm_task",
      "position": { "x": 400, "y": 50 },
      "data": {
        "label": "Pizza Task",
        "task_messages": [
          { "role": "system", "content": "Ask the user what size and type of pizza they want. Use the select_pizza_order function when they provide both size AND type. Pricing: Small $10, Medium $15, Large $20." }
        ],
        "functions": [
          {
            "name": "select_pizza_order",
            "description": "Record pizza order details",
            "properties": {
              "size": { "type": "string", "enum": ["small", "medium", "large"], "description": "Pizza size" },
              "type": { "type": "string", "enum": ["pepperoni", "cheese", "supreme", "vegetarian"], "description": "Pizza type" }
            },
            "required": ["size", "type"],
            "next_node_id": "confirm"
          }
        ]
      }
    },
    {
      "id": "sushi_task",
      "type": "llm_task",
      "position": { "x": 400, "y": 150 },
      "data": {
        "label": "Sushi Task",
        "task_messages": [
          { "role": "system", "content": "Ask the user how many rolls and what type of sushi they want. Use the select_sushi_order function when they provide both count AND type. Pricing: $8 per roll." }
        ],
        "functions": [
          {
            "name": "select_sushi_order",
            "description": "Record sushi order details",
            "properties": {
              "count": { "type": "integer", "minimum": 1, "maximum": 10, "description": "Number of rolls" },
              "type": { "type": "string", "enum": ["california", "spicy tuna", "rainbow", "dragon"], "description": "Sushi type" }
            },
            "required": ["count", "type"],
            "next_node_id": "confirm"
          }
        ]
      }
    },
    {
      "id": "confirm",
      "type": "llm_task",
      "position": { "x": 700, "y": 100 },
      "data": {
        "label": "Confirm",
        "task_messages": [
          { "role": "system", "content": "Read back the order details to the user. Use complete_order if they confirm it's correct, or revise_order if they want to make changes (which will bring them back to choose pizza or sushi again)." }
        ],
        "functions": [
          { "name": "complete_order", "description": "User confirms the order is correct", "next_node_id": "end" },
          { "name": "revise_order", "description": "User wants to change the order", "next_node_id": "initial" }
        ]
      }
    },
    {
      "id": "end",
      "type": "end",
      "position": { "x": 1000, "y": 100 },
      "data": {
        "label": "End",
        "task_messages": [
          { "role": "system", "content": "Thank the user for their order and end the conversation politely." }
        ],
        "post_actions": [{ "type": "end_conversation" }]
      }
    }
  ],
  "edges": []
}
